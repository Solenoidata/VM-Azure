---
title: "Create an Argo Workflow"
teaching: 5
exercises: 20
questions:
- "How can I visualize my workflows?"
- "How do I deploy my Argo GUI?"
objectives:
- "Prepare to deploy the fileserver that mounts the storage volume."
- "Submit your workflow and get the results."
keypoints:
- "With a simple but a tight yaml structure, a full-blown analysis can be performed using the Argo tool on a K8s cluster."
---

## Workflow Definition

In this section, we will explore the structure and components of an Argo Workflow. Workflows in Argo are defined using YAML syntax and consist of various tasks that can be executed sequentially, in parallel, or conditionally.

To define a workflow, create a YAML file (e.g., `my-workflow.yaml`) and define the following:

- Metadata: Provide a name and optional labels for the workflow.
- Spec: Define the workflow's specification, including the list of tasks to be executed.

Here's an example of a simple Argo Workflow definition, get it with:

```bash
wget https://cms-opendata-workshop.github.io/workshop2023-lesson-introcloud/files/argo/container-workflow.yaml
```

```yaml
apiVersion: argoproj.io/v1alpha1
kind: Workflow
metadata:
  name: my-workflow
spec:
  entrypoint: my-task
  templates:
    - name: my-task
      container:
        image: my-image
        command: [echo, "Hello, Argo!"]
```
        
Let's run the workflow:
```
argo submit --watch container-workflow.yaml
```

Open the Argo Workflows UI. Then navigate to the workflow, you should see a single container running.

> ## Exercise
>
> Edit the workflow to make it echo "howdy world".
>
> > ## Solution
> > ~~~
> > apiVersion: argoproj.io/v1alpha1
> > kind: Workflow                 
> > metadata:
> >   generateName: container-   
> > spec:
> >   entrypoint: main         
> >   templates:
> >   - name: main             
> >     container:
> >       image: docker/whalesay
> >       command: [cowsay]         
> >       args: ["howdy world"]
> > ~~~
> > {: .language-yaml}
> >
> {: .solution}
{: .challenge}


## Input Parameters and Artifacts

Workflows often require input parameters and involve passing data between tasks. Argo Workflows supports defining input parameters and utilizing artifacts for data sharing.

To define input parameters, specify them under the inputs section in the workflow specification. Similarly, artifacts can be defined and used as inputs or outputs of tasks.

Here's an example of a workflow with input parameters and artifacts:

```yaml
apiVersion: argoproj.io/v1alpha1
kind: Workflow
metadata:
  name: my-workflow
spec:
  entrypoint: my-task
  arguments:
    parameters:
      - name: message
        value: "Hello, Argo!"
  templates:
    - name: my-task
      inputs:
        parameters:
          - name: message
      container:
        image: my-image
        command: [echo, "{{inputs.parameters.message}}"]
```

In this example, we define an input parameter message with a default value of "Hello, Argo!". The my-task task then uses this parameter value to echo the message.

## Control Flow and Conditionals

Argo Workflows allows you to incorporate control structures like loops and conditionals into your workflows. This enables you to create dynamic and flexible workflows based on specific conditions or iterate over a set of tasks.

To implement control flow and conditionals, utilize the appropriate workflow template structures and expressions within your workflow definition.

Here's an example of a workflow with a conditional task:

```yaml
apiVersion: argoproj.io/v1alpha1
kind: Workflow
metadata:
  name: my-workflow
spec:
  entrypoint: my-task
  templates:
    - name: my-task
      inputs:
        parameters:
          - name: condition
      steps:
        - - name: conditional-step
            template: conditional-template
            when: "{{inputs.parameters.condition}}"
    - name: conditional-template
      container:
        image: my-image
        command: [echo, "Conditional task executed!"]
```

In this example, the workflow contains a task named my-task that includes a conditional step. The execution of the conditional-step is determined by the value of the input parameter condition.

## Workflow Execution and Monitoring
Once you have defined your Argo Workflow, you can submit and execute it using the kubectl command-line tool. Argo Workflows provides commands to submit, monitor, and manage workflows.

To submit a workflow, use the following command:

```bash
kubectl apply -f my-workflow.yaml
```
To monitor the status and progress of a workflow, you can use the following command:
```bash
argo get my-workflow
```
This will display information about the workflow, including the current status and any logs generated by the tasks.

## Conclusion

Congratulations! You have completed the Argo Workflows tutorial, where you learned how to define and execute workflows using Argo. You explored workflow definitions, input parameters, artifacts, control flow, and monitoring.

Argo Workflows offers a wide range of features and capabilities for managing complex workflows in Kubernetes. Continue to explore its documentation and experiment with more advanced workflow scenarios.

Happy workflow orchestrating with Argo!
